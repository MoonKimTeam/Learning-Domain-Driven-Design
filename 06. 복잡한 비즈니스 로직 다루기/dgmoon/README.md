# ch.06 복잡한 비즈니스 로직 다루기

## 도메인 모델

- 도메인 모델 패턴은 복잡한 비즈니스 로직을 다루기 위한 것

### 구현

- 도메인 모델은 행동과 데이터를 모두 포함하는 도메인의 객체 모델
- 애그리게이트, 밸류 오브젝트, 도메인 이벤트, 도메인 서비스

#### 복잡성

- 모델링에 사용되는 객체가 모델에 조금이라도 우발적 복잡성을 추가하면 안 됨

#### 유비쿼터스 언어

- 코드에서 유비쿼터스 언어를 사용하게 하고 도메인 전문가의 멘탈 모델을 따름

### 구성요소

#### 밸류 오브젝트

- 색처럼 복합적인 값에 의해 식별되는 객체
- 색을 식별하기 위한 명시적인 식별 필드가 필요 없음

##### 유비쿼터스 언어

- 유효성 검사 로직이 중복되기 쉽고 값이 사용되기 전에 유효성 검사 로직을 호출하기 어려움
- 명료성이 향상되고 유효성 검사를 할 필요가 없어짐

##### 구현

- 밸류 오브젝트의 필드 중 하나가 바뀌면 개념적으로 밸류 오브젝트의 다른 인스턴스가 생성됨

##### 밸류 오브젝트를 사용하는 경우

- 간단히 밸류 오브젝트는 가능한 모든 경우에 사용하는 게 좋음

#### 엔티티

- 엔티티는 다른 엔티티 인스턴스와 구별하기 위해 명시적인 식별 필드가 필요

#### 애그리게이트

- 엔티티이며, 명시적인 식별 필드가 필요하고 인스턴스의 생애주기 동안 상태가 변할 것으로 예상됨

##### 일관성 강화

- 애그리게이트는 일관성을 강화하는 것이 경계

##### 트랜잭션 경계

- 애그리게이트의 상태는 자신의 비즈니스 로직을 통해서만 수정될 수 있기 때문에 애그리게이트가 트랜잭션 경계의 역할을 함

##### 엔티티 계층

- 여러 객체의 변경을 원자적인 단일 트랜잭션으로 지원하기 위해 애그리게이트 패턴은 엔티티 계층 구조와 유사하게 모든 트랜잭션을 공유해서 일관성을 유지함
- 동일한 트랜잭션 경계에 속한 비즈니스 엔티티와 밸류 오브젝트를 한 데 묶기 때문에 애그리게이트라고 함

##### 다른 애그리게이트 참조하기

- 애그리게이트 내의 모든 객체는 같은 트랜잭션 경계를 공유하기 때문에 애그리게이트가 너무 커지면 성능과 확장 문제가 생길 수 있음

##### 애그리게이트 루트

- 애그리게이트의 상태는 커맨드 중 하나를 실행해서만 수정할 수 있음

##### 도메인 이벤트

- 비즈니스 도메인에서 일어나는 중요한 이벤트를 설명하는 메시지

##### 유비쿼터스 언어

- 애그리게이트는 유비쿼터스 언어를 사용해야 함

#### 도메인 서비스

- 밸류 오브젝트에 속하지 않거나 복수의 애그리게이트 관련 비즈니스 로직을 다루게 될 때 사용
- 도메인 서비스는 비즈니스 로직을 구현한 상태가 없는 객체

### 복잡성 관리

시스템의 자유도는 시스템의 상태를 설명하는 데 필요한 데이터 요소의 개수로 측정됨
