# ch.08 아키텍처 패턴

## 비즈니스 로직과 아키텍처 패턴

- 코드베이스를 조직하는 적절한 방법 혹은 올바른 아키텍처 패턴을 선택하는 것은 단기적으로는 비즈니스 로직 구현을 지원하고, 장기적으로 유지보수를 돕기 위해 매우 중요함

## 계층형 아키텍처

### 프리젠테이션 계층

- 사용자와 상호작용을 하기 위한 프로그램의 사용자 인터페이스를 구현

### 비즈니스 로직 계층

- 프로그램의 비즈니스 로직을 구현하고 묶는 것을 담당함

### 데이터 접근 계층

- 영속성 메커니즘에 접근할 수 있게 해줌

### 계층 간 커뮤니케이션

- 톱다운 커뮤니케이션 모델에 따라 연동
- 각 계층은 바로 아래 계층에만 의존함

### 변종(variation)

#### 서비스 계층

- 서비스 계층은 프로그램의 프레젠테이션 계층과 비즈니스 로직 계층 사이의 중간 역할을 함
- 비즈니스 로직 계층으로의 관문 역할을 함

#### 용어

### 계층형 아키텍처를 사용하는 경우

- 비즈니스 로직이 트랜잭션 스크립트 또는 액티브 레코드 패턴을 사용하여 구현된 시스템에 계층형 아키텍처 패턴이 적합함
- 도메인 모델을 구현하는 데 계층형 아키텍처 패턴을 적용하는 건 어려움

## 포트와 어댑터

- 계층형 아키텍처의 단점을 해결하고 좀 더 복잡한 비즈니스 로직을 구현하는 데 적합함

### 의존성 역전 원칙

- 비즈니스 로직을 구현하는 상위 수준의 모듈에 의존해서는 안 됨
- 의존성 역전 원칙을 쓰면 비즈니스 로직 계층은 프레젠테이션 계층과 데이터 접근 계층에 끼어 있는 대신, 중심적인 역할을 맡음

### 인프라 구성요소의 연동

- 포트와 어댑터 아키텍처의 핵심 목적은 인프라스트럭처 구성요소부터 시스템의 비즈니스 로직을 분리하는 것

### 변형

- 헥사고날 아키텍처, 어니언 아키텍처, 클린 아키텍처로 알려짐

### 포트와 어댑터를 사용하는 경우

- 모든 기술적 관심사로부터 비즈니스 로직을 분리하는 것이 포트와 어댑터의 목적
- 도메인 모델 패턴을 사용하여 구현한 비즈니스 로직에 적합

## CQRS

- 포트와 어댑터와 동일한 비즈니스 로직과 인프라스트럭처 관심사에 기반
- 시스템의 데이터를 관리하는 방식이 다름
- 여러 영속 모델에 시스템의 데이터를 표현 가능

### 폴리글랏 모델링

- 다양한 언어를 사용하는 영속성 개념과 관련
- 완벽한 데이터베이스는 없음
- CQRS 패턴은 이벤트 소싱과 밀접하게 관련이 있음
- 원래 CQRS는 이벤트 소싱 모델의 질의 한계를 극복하려고 정의됨

#### 구현

- 이 패턴은 시스템 모델의 책임을 분리시킴

#### 커맨드 실행 모델

- 시스템의 상태를 수정하는 오퍼레이션을 전담으로 수행하는 단일 모델이 있음

#### 읽기 모델(프로젝션)

- 읽기 모델은 캐시에서 언제든 다시 추출할 수 있는 프로젝션

### 읽기 모델의 프로젝션

#### 동기식 프로젝션

- 격차 해소 구독 모델을 통해 OLTP 데이터의 변경 사항을 가져옴

#### 비동기식 프로젝션

- 비동기식 프로젝션 시나리오에서 커맨드 실행 모델은 모든 커밋된 변경 사항을 메시지 버스에 발행함

### 도전 과제

- 분산 컴퓨팅에서 문제가 발생하기 더 쉬움

### 모델 분리

- CQRS 아키텍처에서 시스템 모델이 담당하는 책임은 그 타입에 따라 분리됨

### CQRS를 사용해야 하는 경우

- 여러 모델, 궁극적으로 다양한 종류의 데이터베이스에 저장된 동일한 데이터와 작동할 필요가 있는 애플리케이션에 유용함

## 범위

- 앞서 논의한 패턴들은 시스템 전체에 적용하는 구성 원칙으로 취급하면 안 됨
- 하위 도메인에는 핵심, 지원, 일반의 다양한 타입이 있음
- 동일한 타입의 하위 도메인도 다양한 비즈니스 로직과 아키텍처 패턴이 필요할 수 있음
- 시스템을 수평으로 분할하는 계층 외에도 수직으로 나누는 것을 추가로 도입 가능
- 적절한 수직 경계는 모놀리식 바운디드 컨텍스트를 모듈화하고 커다란 진흙 덩어리가 되는 것을 방지하는 데 도움을 줌

