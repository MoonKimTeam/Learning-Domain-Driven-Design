# 도메인 복잡성 관리

프로젝트의 성공을 보장하려면 소프트웨어 엔지니어부터 도메인 전문가에 이르기까지 모든 이해관계자가 의사소통에 사용할 수 있는 유비쿼터스 언어를 개발하는 것이 중요합니다.   
언어는 비즈니스 도메인의 내부 동작과 기본 원칙에 대한 도메인 전문가의 멘탈 모델을 반영해야 합니다.

우리의 목표는 유비쿼터스 언어를 사용하여 소프트웨어 설계의 의사결정을 내리는 것이기 때문에 언어는 명확하고 일관성이 있어야 합니다.   
모호성, 암묵적인 가정, 관련 없는 세부사항이 없어야 합니다. 그러나 조직 규모에 따라 도메인 전문가의 멘탈 모델은 일관성이 없을 수 있습니다.  
같은 비즈니스 도메인에서도 도메인 전문가마다 서로 다른 모델을 사용할 수 있습니다.

## 일관성 없는 모델

2장의 텔레마케팅 회사의 예로 돌아가 보겠습니다.  
회사의 마케팅 부서는 온라인 광고를 통해 리드(lead)를 생성합니다. 영업 부서는 잠재고객이 제품이나 서비스를 구매하도록 유도하는 역할을 합니다.  
도메인 전문가의 언어를 살펴보면 특이한 점이 있습니다. **리드(lead)** 라는 용어가 마케팅과 영업 부서에서 서로 다른 의미로 사용됩니다.

### 마케팅 부서

마케팅 담당자에게 리드는 누군가가 제품 중 하나에 관심이 있다는 알림을 나타냅니다. 잠재고객의 연락처 정보를 수신하는 이벤트는 리드로 간주합니다.

### 영업 부서

영업 부서 컨텍스트에서 리드는 훨씬 더 복잡합니다. 리드는 영업 프로세스의 전체 수명주기를 나타냅니다. 단순한 이벤트가 아니라 장기적으로 진행되는 과정입니다.

### 텔레마케팅 회사의 유비쿼터스 언어 공식화

우리는 유비쿼터스 언어가 일관성이 있어야 한다는 것을 알고 있습니다. 각 용어는 하나의 의미를 가져야 합니다.   
또한 유비쿼터스 언어가 도메인 전문가의 멘탈 모델을 반영해야 하는 것도 알고 있습니다. 텔레마케팅 회사의 경우 영업과 마케팅 부서의 도메인 전문가 사이에 '리드'의 멘탈 모델에 차이가 있습니다.

이러한 모호성은 개인 대 개인의 의사소통에서는 그다지 큰 문제가 되지 않습니다. 실제로 다른 분야의 사람들 사이에서 의사소통이 어려울 수 있지만, 사람들이 서로 상호작용하면서 정확한 의미를 추론하는 것은 쉽습니다.

그러나 이러한 다양한 비즈니스 도메인 모델을 소프트웨어로 표현하는 것은 더 어렵습니다. 소프트웨어 코드는 모호성에 잘 대처하지 못합니다.

- 영업 부서의 복잡한 모델을 마케팅 부서에 적용하면 복잡하지 않은 곳에서 복잡성을 키우게 될 것입니다
- 마케팅 담당자가 광고 캠페인을 최적화하는 데 필요한 것보다 훨씬 더 많은 불필요한 세부 사항과 행동이 있기 때문입니다 (과잉설계, over-engineered)
- 반대로 마케팅의 영업 모델을 단순화하려고 하면 영업 프로세스를 관리하고 최적화하기에는 너무 적은 데이터를 제공하기 때문에 엔지니어링이 조금 더 필요한 솔루션(under-engineered)을 얻게 됩니다

## 이 딜레마를 어떻게 해결할까?

이 문제에 대한 전통적인 솔루션은 모든 종류의 문제에 사용할 수 있는 단일 모델을 설계하는 것입니다. 이러한 모델은 전체 사무실 벽에 걸쳐 있는 거대한 ERD(Entity Relationship Diagram: 엔터티 관계 다이어그램)를 생성합니다.

> 이것저것 다 잘하는 사람은 단 한 분야에서도 달인이 될 수 없다(Jack of all trades, master of none)

이러한 모델은 모든 것에 적합해야 하지만 결국에는 아무 소용이 없습니다. 무엇을 하든지 항상 복잡성에 직면하게 됩니다.  
즉, 관련 없는 세부사항을 필터링하는 복잡성, 필요한 것을 찾는 복잡성, 가장 중요하게는 데이터를 알려진 상태로 유지해야 하는 복잡성에 직면합니다.

또 다른 솔루션은 '마케팅 리드', '영업 리드'와 같이 문맥상 정의에 문제가 있는 용어 앞에 접두사를 추가하는 것입니다.   
그러면 두 모델을 코드로 만들 수 있습니다. 그러나 이 접근 방식에는 두 가지 주요 단점이 있습니다:

1. 첫째, 인지부하를 유발합니다. 각 모델은 언제 사용해야 할까요?
2. 둘째, 모델의 구현은 유비쿼터스 언어와 일치하지 않습니다

## 바운디드 컨텍스트란 무엇인가?

도메인 주도 설계에서 솔루션은 간단합니다. 유비쿼터스 언어를 여러 개의 작은 언어로 나눈 다음 각 언어를 적용할 수 있는 명시적인 **바운디드 컨텍스트(bounded context)** 에 할당하면 됩니다.

앞의 예에서 마케팅과 영업이라는 두 가지 바운디드 컨텍스트를 식별할 수 있습니다.  
'리드'라는 용어는 두 가지 바운디드 컨텍스트에 모두 존재합니다. 각 바운디드 컨텍스트마다 단일 의미를 갖는 한, 세분화된 유비쿼터스 언어가 각각은 일관성을 띠며 도메인 전문가의 멘탈 모델을 따릅니다.

어떤 의미에서 용어 충돌과 암묵적 컨텍스트는 일정 규모 이상의 모든 비즈니스에 내재된 부분입니다. 바운디드 컨텍스트 패턴을 사용하면 컨텍스트를 명시적이고 중요한 비즈니스 도메인의 요소로 모델링합니다.

## 모델 경계

이전 장에서 논의했듯이 모델은 실제 세계의 복사본이 아니라 복잡한 시스템을 이해하는 데 도움을 주기 위해 구조화한 것입니다.   
우리가 해결하려는 문제가 모델 본연의 목적입니다. 모델은 경계 없이 존재할 수 없습니다. 경계가 없다면 현실 세계의 복제본처럼 확장될 것입니다.  
따라서 모델의 경계(바운디드 컨텍스트)를 정의하는 것은 모델링 프로세스의 본질적인 부분입니다.

## 정제된 유비쿼터스 언어

바운디드 컨텍스트를 통해 유비쿼터스 언어의 정의를 완성할 수 있습니다.  
대신 유비쿼터스 언어는 바운디드 컨텍스트 경계 안에서만 보편적으로 적용됩니다.   
유비쿼터스 언어는 바운디드 컨텍스트에 포함된 모델을 설명하는 데만 집중합니다.  
모델은 우리가 해결해야 할 문제가 있기 때문에 유비쿼터스 언어는 명시적으로 적용 가능한 컨텍스트 없이는 정의하거나 사용할 수 없습니다.

## 바운디드 컨텍스트의 범위
 
서로 다른 도메인 전문가들은 동일한 비즈니스 엔티티에 대해 상충되는 멘탈 모델을 가지고 있습니다.  
비즈니스 도메인을 모델링하기 위해 우리는 모델을 분할하고, 각 세분화된 모델을 적용 가능한 컨텍스트인 바운디드 컨텍스트를 엄격하게 정의해야 했습니다.  
유비쿼터스 언어의 일관성은 해당 언어의 가장 넓은 경계를 식별하는 데 도움이 될 뿐입니다. 일관성이 없는 모델과 용어가 있기 때문에 더 이상 커질 수 없습니다.

## 바운디드 컨텍스트의 크기

유비쿼터스 언어의 범위(바운디드 컨텍스트)를 정의하는 것은 전략적인 설계 의사결정입니다. 경계는 비즈니스 도메인의 고유한 컨텍스트에 따라 넓힐 수 있고, 비즈니스 도메인을 더 작은 문제 도메인으로 세분화하여 좁힐 수도 있습니다.

바운디드 컨텍스트의 크기 자체는 의사결정 요소가 아닙니다. 모델의 크기에 정답은 없습니다. 다만 용어 자체로 유용해야 합니다.   
유비쿼터스 언어의 경계가 넓을수록 일관성을 유지하기가 더 어렵습니다. 단, 유비쿼터스 언어를 더 작고 관리하기 쉬운 문제 도메인으로 나누는 것은 도움이 될 수 있지만, 바운디드 컨텍스트를 작게 만들기 위해 노력하는 것은 역효과가 날 수 있습니다.   
더 작게 만들면 설계를 통합하는 오버헤드가 커집니다.

따라서 바운디드 컨텍스트의 크기에 대한 결정은 문제 도메인이 무엇이냐에 따라 달라집니다. 더 크고 넓은 경계를 사용하는 것이 더 명확하고, 어떤 경우에는 분해하는 것이 더 합리적입니다.

## 바운디드 컨텍스트 대 하위 도메인

2장에서 비즈니스 도메인이 여러 하위 도메인으로 구성되는 것을 확인했습니다. 이번 장에서는 거기서 비즈니스 도메인을 세분화된 문제 도메인 또는 바운디드 컨텍스트의 집합으로 분해하는 방법을 살펴봤습니다.

### 하위 도메인

기업의 비즈니스 전략을 이해하려면 비즈니스 도메인을 분석해야 합니다. 도메인 주도 설계 방법론에 따르면 분석 단계에는 다양한 하위 도메인(핵심, 지원, 일반)을 식별하는 작업이 포함합니다. 그것이 바로 조직이 일하고 경쟁 전략을 계획하는 방식입니다.

하위 도메인은 상호 관련된 유스케이스 집합과 유사합니다. 유스케이스는 비즈니스 도메인과 시스템 요구사항에 따라 정의합니다.  
소프트웨어 엔지니어로서 우리는 요구사항을 정의하지 않습니다. 그것은 비즈니스가 담당합니다. 대신 소프트웨어 엔지니어는 하위 도메인을 분석합니다.

### 바운디드 컨텍스트

반면에 바운디드 컨텍스트는 소프트웨어 엔지니어에 의해 설계됩니다. 모델의 경계를 선택하는 것은 전략적 설계의 의사결정입니다.  
우리는 비즈니스 도메인을 더 작고 관리 가능한 문제 도메인으로 어떻게 나눌지 결정합니다.

### 하위 도메인과 바운디드 컨텍스트 사이의 상호작용

비현실적이지만 이론적으로는 단일 모델이 전체 비즈니스 도메인에 적용될 수 있습니다. 이러한 현상은 소규모 시스템에서 효과적일 수 있습니다.  
모델이 충돌하면 도메인 전문가의 멘탈 모델을 따라 시스템을 바운디드 컨텍스트로 분해할 수 있습니다. 모델이 여전히 크고 유지보수하기 어려운 경우 더 작은 바운디드 컨텍스트로 분해할 수 있습니다.  
어느 쪽이든 이것은 설계에 대한 의사결정입니다. 우리는 이러한 경계를 솔루션의 일부로 설계합니다.

어떤 시나리오에서는 바운디드 컨텍스트와 하위 도메인 간에 일대일 관계를 맺는 것이 완벽하게 합리적일 때가 있습니다. 반면 어떤 경우에는 다른 분해 전략이 더 적합할 수 있습니다.  
중요한 것은 하위 도메인은 발견하고 바운디드 컨텍스트는 설계한다는 점입니다.

## 경계

루스 말란(Ruth Malan)이 말했듯이 건축 설계는 본질적으로 경계에 대한 것입니다.

> 건축 설계는 시스템 설계, 시스템 설계는 상황에 맞는 설계다.  
> 본질적으로 경계가 무엇이 들어 있는지 무엇이 밖으로 나가는지 범위가 무엇인지 그 사이를 이동하는지와 균형에 관한 것이다. 내부의 모양을 구성하는 것처럼 외부의 모양도 재구성한다.

바운디드 컨텍스트 패턴은 물리적 경계와 소유권 경계를 규정하기 위한 도메인 주도 설계 도구입니다.

### 물리적 경계

바운디드 컨텍스트는 모델 경계뿐만 아니라 이를 구현하는 시스템의 물리적 경계 역할도 합니다.   
각 바운디드 컨텍스트는 개별 서비스/프로젝트로 구현해야 합니다. 즉, 구현, 진화, 버전 관리를 각각의 다른 바운디드 컨텍스트와 독립적으로 해야 합니다.

바운디드 컨텍스트 간의 명확한 물리적 경계를 통해 각 바운디드 컨텍스트 요구사항에 가장 적합한 기술 스택으로 구현할 수 있습니다.

앞에서 논의한 바와 같이 바운디드 컨텍스트는 여러 하위 도메인을 포함할 수 있습니다. 이러한 경우 바운디드 컨텍스트는 물리적 경계이고 하위 도메인은 논리적 경계입니다.   
논리적 경계는 프로그래밍 언어의 종류에 따라 네임스페이스나 모듈, 패키지 같은 다른 이름을 갖습니다.

### 소유권 경계

좋은 담장은 실제로 좋은 이웃을 만든다는 연구처럼, 이웃과 잘 지내기 위해서는 서로 간에 독립성과 존중을 유지하는 것이 필요합니다.  
소프트웨어 프로젝트에서도 팀 간의 평화로운 공존을 위해 모델 경계(바운디드 컨텍스트)를 활용할 수 있습니다. 팀 간의 작업 분배는 바운디드 컨텍스트 패턴을 사용하여 나눌 수 있습니다.

바운디드 컨텍스트는 한 팀에서만 구현, 발전, 유지 관리해야 합니다. 두 팀이 같은 바운디드 컨텍스트에서 작업할 수 없습니다.  
이러한 분리는 팀이 서로의 모델에 대해 만들 수 있는 암묵적인 가정을 제거합니다.   
대신 팀은 서로 다른 바운디드 컨텍스트로 분리된 모델과 시스템을 명시적으로 통신하기 위한 통신 프로토콜을 정의해야 합니다.

팀과 바운디드 컨텍스트 간의 관계는 단방향이라는 점에 주목합니다. 바운디드 컨텍스트는 한 팀 소유여야 합니다.  
그러나 단일 팀이 여러 개의 바운디드 컨텍스트를 소유할 수도 있습니다.

